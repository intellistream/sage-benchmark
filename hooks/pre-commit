#!/bin/bash
# Pre-commit hook for sage-benchmark
# Runs code quality checks before allowing commit

set -e

echo "üîç Running pre-commit checks..."

# Check if ruff is installed
if ! command -v ruff &> /dev/null; then
    echo "‚ö†Ô∏è  ruff not found, skipping format check"
else
    echo "üìù Checking code formatting..."
    if ! ruff format --check .; then
        echo "‚ùå Code formatting issues found. Run: ruff format ."
        exit 1
    fi
    echo "‚úÖ Code formatting check passed"

    echo "üîç Running linter..."
    if ! ruff check .; then
        echo "‚ùå Linting issues found. Run: ruff check --fix ."
        exit 1
    fi
    echo "‚úÖ Linting check passed"
fi

# Check for common issues
echo "üîç Checking for common issues..."

# Check for hardcoded API keys
if git diff --cached --name-only | xargs grep -i "api[_-]key\s*=\s*['\"]sk-" 2>/dev/null; then
    echo "‚ùå Hardcoded API keys detected!"
    exit 1
fi

# Check for debug statements
if git diff --cached --name-only | xargs grep -i "import pdb\|breakpoint()" 2>/dev/null; then
    echo "‚ö†Ô∏è  Debug statements detected (pdb/breakpoint)"
    echo "Remove them or use --no-verify to skip this check"
    exit 1
fi

echo "‚úÖ All pre-commit checks passed!"
